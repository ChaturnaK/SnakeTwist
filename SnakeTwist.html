<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#38bdf8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#38bdf8">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Modern Snake Game (Edge Swipe)</title>
    <style>
        body {
            background: linear-gradient(135deg, #e9e9f2 0%, #f6faff 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #pause-btn {
            position: fixed;
            top: 16px;
            right: 22px;
            z-index: 201;
            background: #fff;
            border: 2px solid #38bdf8;
            color: #0ea5e9;
            border-radius: 12px;
            font-size: 1.3em;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px #38bdf833;
            transition: background 0.14s, box-shadow 0.14s;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        #pause-btn:active {
            background: #bae6fd;
        }

        #pause-btn[hidden] {
            display: none;
        }

        #paused-overlay {
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.35);
            z-index: 2002;
            display: none;
            align-items: center;
            justify-content: center;
        }

        #paused-overlay-inner {
            background: #fff;
            padding: 40px 32px 34px 32px;
            border-radius: 24px;
            font-size: 2em;
            color: #0ea5e9;
            font-family: 'Segoe UI', Arial, sans-serif;
            box-shadow: 0 6px 36px #38bdf833;
            text-align: center;
            min-width: 220px;
            max-width: 80vw;
        }

        #score-bar {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: #334155;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
            background: #fff;
            padding: 8px 30px;
            border-radius: 22px;
            box-shadow: 0 2px 8px #93c5fd33;
            user-select: none;
        }

        #speed-bar-container {
            width: 410px;
            margin-bottom: 16px;
            margin-top: 2px;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        #speed-bar-labels {
            width: 100%;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #64748b;
            padding: 0 6px;
            box-sizing: border-box;
        }

        #speed-bar {
            width: 100%;
            height: 16px;
            background: #f3f4f6;
            border-radius: 8px;
            border: 2px solid #cbd5e1;
            box-shadow: 0 2px 8px #bae6fd66;
            position: relative;
            overflow: hidden;
            margin-bottom: 2px;
            margin-top: 3px;
        }

        #speed-bar-indicator {
            position: absolute;
            top: 0;
            bottom: 0;
            height: 100%;
            border-radius: 8px;
            transition: left 0.08s cubic-bezier(.4, 2, .7, 1), width 0.1s cubic-bezier(.4, 2, .7, 1), background 0.2s;
        }

        #control-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            z-index: 20;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #control-modal>div {
            background: #fff;
            padding: 30px 25px 20px 25px;
            border-radius: 20px;
            text-align: center;
            min-width: 250px;
            max-width: 94vw;
        }

        #control-modal button {
            font-size: 1em;
            padding: 10px 30px;
            margin: 8px 0;
            border-radius: 10px;
            border: none;
            background: #38bdf8;
            color: #fff;
            cursor: pointer;
            transition: background 0.16s;
        }

        #control-modal button:active {
            background: #0ea5e9;
        }

        #control-modal button:disabled {
            background: #ddd !important;
            color: #aaa !important;
            cursor: not-allowed;
        }

        #tilt-sensitivity-container {
            margin: 10px 0 0 0;
            padding: 10px;
            border-radius: 8px;
            background: #f6faff;
            box-shadow: 0 2px 10px #bae6fd33;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        #tilt-sensitivity-bar {
            width: 150px;
        }

        canvas {
            background: #f8fafc;
            border: 4px solid #38bdf8;
            border-radius: 22px;
            box-shadow: 0 8px 32px #38bdf866, 0 0 0 2px #bae6fd88;
            display: block;
            margin-top: 16px;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* EDGE SWIPE CONTROL AREA */
        @media (max-width: 600px) {
            #swipe-edge-area {
                position: fixed;
                left: 0;
                top: 0;
                width: 100vw;
                height: 100vh;
                z-index: 130;
                background: rgba(0, 0, 0, 0);
                touch-action: none;
                user-select: none;
            }

            .game-container {
                gap: 10vw;
            }

            #score-bar {
                margin-bottom: 3vw;
            }

            #speed-bar-container {
                margin-bottom: 2vw;
            }

            canvas#gameCanvas {
                margin-top: 3vw;
            }
        }
    </style>
</head>

<body>
    <button id="pause-btn" title="Pause/Resume" hidden>‚è∏Ô∏è</button>
    <button id="reset-dpad-btn" title="Set D-pad Position" hidden>üéØ</button>
    <div id="paused-overlay">
        <div id="paused-overlay-inner">
            <div style="font-size:1.5em;margin-bottom:16px;">‚è∏Ô∏è Game Paused</div>
            <button onclick="resumeGame()"
                style="font-size:1em;padding:10px 32px;border-radius:10px;background:#38bdf8;color:#fff;border:none;cursor:pointer;">Resume</button>
        </div>
    </div>
    <input type="checkbox" id="haptic-switch" switch style="display:none">
    <div class="game-container">
        <div id="score-bar">Score: 0</div>
        <div id="speed-bar-container">
            <div id="speed-bar-labels">
                <span style="color:#f43f5e">Braking</span>
                <span style="color:#64748b;">Normal</span>
                <span style="color:#06b6d4">Accelerating</span>
            </div>
            <div id="speed-bar">
                <div id="speed-bar-indicator"></div>
            </div>
        </div>
        <div id="tilt-sensitivity-container" style="display:none;"></div>
        <canvas id="gameCanvas" width="400" height="400"
            style="max-width:96vw;max-height:96vw;min-width:220px;min-height:220px;"></canvas>
    </div>
    <div id="dpad-container"></div>
    <div id="dpad-overlay" style="display:none;">
        <div id="dpad-instruction">Tap where you want the D-pad</div>
    </div>
    <div id="control-modal">
        <div>
            <h2 style="margin:0 0 18px;font-size:1.5em;">Choose Control Mode</h2>
            <button id="tap-mode-btn">Touch/Arrow Keys</button>
            <button id="tilt-mode-btn" style="display:none;">Tilt (disabled)</button>
        </div>
    </div>
    <script>
        /* Utility and setup functions (shortened for space in this sample) */

        function isTouchDevice() {
            return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        }
        let dpadPosition = { x: 0, y: 0 }; // left, top (in px)
        let dpadActive = false, dpadDirection = null, dpadHoldStart = null, dpadAccelerating = false;
        const dpadAccelTime = 600; // ms before accelerating on dpad (keyboard is faster)
        const dpadStep = 4; // slow acceleration step
        let isPaused = false, pauseBtn, resetDpadBtn, dpadContainer, dpadOverlay, dpadInstruction;
        let snake, direction, nextDirection, food, score, holdingKey, heldDirection, currentSpeed;
        let gameStarted = false, animationFrameId = null, tileCount = 40, gridSize = 10, animState = "normal", animTick = 0;
        let minSpeed = 25, maxSlowSpeed = 200, accelerationStep = 7, decelerationStep = 6;

        /* D-pad HTML generator */
        function showDpad(x = null, y = null) {
            if (!isTouchDevice()) { dpadContainer.innerHTML = ""; return; }
            dpadContainer.innerHTML = `
    <div id="dpad" style="
        position:fixed; left:${x ?? dpadPosition.x}px; top:${y ?? dpadPosition.y}px; 
        width:92px;height:92px;z-index:150;display:flex;align-items:center;justify-content:center;">
        <div style="position:relative;width:92px;height:92px;">
            <button class="dpad-btn dpad-up"    style="position:absolute;left:30px;top:0;width:32px;height:32px;border-radius:50%;border:none;background:#bae6fd;font-size:1.7em;">‚ñ≤</button>
            <button class="dpad-btn dpad-down"  style="position:absolute;left:30px;bottom:0;width:32px;height:32px;border-radius:50%;border:none;background:#bae6fd;font-size:1.7em;">‚ñº</button>
            <button class="dpad-btn dpad-left"  style="position:absolute;top:30px;left:0;width:32px;height:32px;border-radius:50%;border:none;background:#bae6fd;font-size:1.7em;">‚óÄ</button>
            <button class="dpad-btn dpad-right" style="position:absolute;top:30px;right:0;width:32px;height:32px;border-radius:50%;border:none;background:#bae6fd;font-size:1.7em;">‚ñ∂</button>
        </div>
    </div>
    `;
            bindDpadEvents();
        }
        function bindDpadEvents() {
            const dirs = ['up', 'down', 'left', 'right'];
            dirs.forEach(dir => {
                const btn = document.querySelector(`.dpad-${dir}`);
                if (!btn) return;
                btn.ontouchstart = e => {
                    e.preventDefault(); dpadDirection = dir;
                    dpadActive = true; dpadHoldStart = Date.now(); dpadAccelerating = false;
                    handleDpadPress(dir);
                };
                btn.ontouchend = e => {
                    e.preventDefault(); dpadDirection = null; dpadActive = false; dpadHoldStart = null; dpadAccelerating = false;
                    holdingKey = false; heldDirection = null;
                };
            });
        }
        /* D-pad logic */
        function handleDpadPress(dir) {
            if (dir && dir !== direction && !isOppositeDirection(dir, direction)) {
                nextDirection = dir;
                holdingKey = true;
                heldDirection = dir;
            }
        }
        /* D-pad position logic */
        function setDpadPosition(x, y) {
            dpadPosition.x = Math.max(0, x - 46);
            dpadPosition.y = Math.max(0, y - 46);
            showDpad();
        }
        function startDpadPlacement() {
            isPaused = true; showPausedOverlay();
            dpadOverlay.style.display = 'block';
            dpadInstruction.textContent = "Tap where you want the D-pad";
        }
        function finishDpadPlacement(x, y) {
            setDpadPosition(x, y);
            dpadOverlay.style.display = 'none';
            isPaused = false; hidePausedOverlay();
        }
        /* Game setup, pause, resume, etc. */
        function startGameWithTap() {
            resetGameVars();
            pauseBtn.hidden = false; resetDpadBtn.hidden = !isTouchDevice();
            if (isTouchDevice()) showDpad();
            isPaused = false; hidePausedOverlay();
            gameStarted = true; draw();
        }
        function togglePause() {
            if (!gameStarted) return;
            isPaused = !isPaused;
            if (isPaused) showPausedOverlay();
            else { hidePausedOverlay(); draw(); }
        }
        function resumeGame() {
            if (isPaused) { isPaused = false; hidePausedOverlay(); draw(); }
        }
        function showPausedOverlay() { pausedOverlay.style.display = "flex"; }
        function hidePausedOverlay() { pausedOverlay.style.display = "none"; }
        function isOppositeDirection(dir1, dir2) {
            return (dir1 === 'left' && dir2 === 'right') || (dir1 === 'right' && dir2 === 'left')
                || (dir1 === 'up' && dir2 === 'down') || (dir1 === 'down' && dir2 === 'up');
        }
        function getNormalSpeed(score) {
            return Math.max(100 - Math.floor(score / 5) * 5, 45);
        }
        function resetGameVars() {
            snake = [{ x: 10, y: 10 }]; direction = 'right'; nextDirection = 'right';
            food = getNewFoodPosition(); score = 0;
            holdingKey = false; heldDirection = null;
            currentSpeed = getNormalSpeed(0); animState = "normal"; animTick = 0;
        }
        /* Main Game Loop */
        function draw() {
            if (isPaused) return;
            let targetNormalSpeed = getNormalSpeed(score);
            // Dpad logic: check for long press to accelerate
            if (isTouchDevice() && dpadActive && dpadDirection) {
                if (Date.now() - dpadHoldStart > dpadAccelTime) dpadAccelerating = true;
                if (dpadAccelerating && dpadDirection === direction) currentSpeed = Math.max(minSpeed, currentSpeed - dpadStep);
            }
            if (holdingKey && heldDirection === direction && currentSpeed < targetNormalSpeed - 3) animState = "accelerating";
            else if (holdingKey && isOppositeDirection(heldDirection, direction) && currentSpeed > targetNormalSpeed + 3) animState = "braking";
            else animState = "normal";
            if (holdingKey && heldDirection === direction) {
                currentSpeed -= isTouchDevice() ? dpadStep : accelerationStep;
                if (currentSpeed < minSpeed) currentSpeed = minSpeed;
            } else if (holdingKey && isOppositeDirection(heldDirection, direction)) {
                currentSpeed += decelerationStep * 2; if (currentSpeed > maxSlowSpeed) currentSpeed = maxSlowSpeed;
            } else {
                if (currentSpeed > targetNormalSpeed) {
                    currentSpeed -= decelerationStep; if (currentSpeed < targetNormalSpeed) currentSpeed = targetNormalSpeed;
                } else if (currentSpeed < targetNormalSpeed) {
                    currentSpeed += decelerationStep; if (currentSpeed > targetNormalSpeed) currentSpeed = targetNormalSpeed;
                }
            }
            direction = nextDirection;
            const head = { ...snake[0] };
            switch (direction) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }
            snake.unshift(head);
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) { gameOver(); return; }
            if (snake.slice(1).some(segment => segment.x === head.x && segment.y === head.y)) { gameOver(); return; }
            if (head.x === food.x && head.y === food.y) { score++; food = getNewFoodPosition(); } else { snake.pop(); }
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // (Draw code same as before, omitted for brevity)
            // ... draw food, snake, score, speed bar, etc ...
            animationFrameId = setTimeout(() => requestAnimationFrame(draw), currentSpeed);
        }
        function getNewFoodPosition() {
            let pos; while (true) {
                pos = { x: Math.floor(Math.random() * tileCount), y: Math.floor(Math.random() * tileCount) };
                if (!snake.some(segment => segment.x === pos.x && segment.y === pos.y)) return pos;
            }
        }
        function gameOver() {
            clearTimeout(animationFrameId);
            setTimeout(() => { alert(`Game Over! Your score: ${score}`); resetGameVars(); draw(); }, 200);
        }
        /* Responsive Canvas */
        function fitCanvas() {
            let size = Math.min(window.innerWidth * 0.96, window.innerHeight * 0.7, 400);
            canvas.style.width = size + "px"; canvas.style.height = size + "px";
            gridSize = Math.floor(size / tileCount); canvas.width = gridSize * tileCount; canvas.height = gridSize * tileCount;
        }
        window.addEventListener("resize", fitCanvas);
        /* Initialize everything on load */
        window.onload = () => {
            pauseBtn = document.getElementById("pause-btn");
            resetDpadBtn = document.getElementById("reset-dpad-btn");
            dpadContainer = document.getElementById("dpad-container");
            dpadOverlay = document.getElementById("dpad-overlay");
            dpadInstruction = document.getElementById("dpad-instruction");
            fitCanvas();
            pauseBtn.onclick = togglePause;
            resetDpadBtn.onclick = () => startDpadPlacement();
            dpadOverlay.onclick = e => {
                let x = e.touches ? e.touches[0].clientX : e.clientX;
                let y = e.touches ? e.touches[0].clientY : e.clientY;
                finishDpadPlacement(x, y);
            };
            document.getElementById('tap-mode-btn').onclick = function () {
                document.getElementById('control-modal').style.display = "none";
                startGameWithTap();
            };
            document.getElementById('tilt-mode-btn').style.display = "none"; // hide tilt
            // Hide dpad on desktop
            resetDpadBtn.hidden = !isTouchDevice();
            pauseBtn.hidden = false;
        };
    </script>
    <style>
        /* Style for dpad, overlay, buttons */
        #dpad-container {
            z-index: 150;
        }

        #dpad-overlay {
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            z-index: 2001;
            background: rgba(56, 189, 248, 0.13);
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
        }

        #dpad-instruction {
            font-size: 1.5em;
            color: #0ea5e9;
            background: #fff;
            padding: 32px 24px;
            border-radius: 18px;
            box-shadow: 0 2px 24px #bae6fd33;
        }

        #reset-dpad-btn {
            position: fixed;
            top: 16px;
            right: 85px;
            z-index: 202;
            background: #fff;
            border: 2px solid #38bdf8;
            color: #0ea5e9;
            border-radius: 12px;
            font-size: 1.25em;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px #38bdf833;
            transition: background 0.14s, box-shadow 0.14s;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        #reset-dpad-btn:active {
            background: #bae6fd;
        }

        #reset-dpad-btn[hidden] {
            display: none;
        }
    </style>
</body>

</html>